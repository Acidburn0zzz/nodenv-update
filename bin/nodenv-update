#!/usr/bin/env bash
set -e
[ -n "$NODENV_DEBUG" ] && set -x

indent_output() {
  while read data; do
    echo -e " \033[1;32m|\033[0m  $data"
  done
}

is_nodenv_git_repo() {
  $(git remote -v | grep -E 'nodenv|node-build' &>/dev/null)
}

nodenv_update() {
  echo -e "\033[1;32mupdating $1\033[0m"
  if is_nodenv_git_repo; then
    git pull --no-rebase --ff 2>&1 | indent_output
  else
    echo -e "Not a nodenv git repo; skipping..." | indent_output
  fi
  echo
}

cd "$(dirname $(which nodenv))"
nodenv_update nodenv

cd "${NODENV_ROOT:-$(nodenv root)}"
for plugin in plugins/*; do
  pushd $plugin >/dev/null
  nodenv_update `basename $plugin`
  popd >/dev/null
done
